<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Sistema de Turnos</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        .stats-card {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            margin-bottom: 1rem;
            transition: transform 0.3s ease;
        }
        .stats-card:hover {
            transform: translateY(-5px);
        }
        .stats-card.warning {
            background: linear-gradient(45deg, #f093fb 0%, #f5576c 100%);
        }
        .stats-card.success {
            background: linear-gradient(45deg, #4facfe 0%, #00f2fe 100%);
        }
        .stats-card.info {
            background: linear-gradient(45deg, #43e97b 0%, #38f9d7 100%);
        }
        .stats-card h3 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .table-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
        }
        .navbar-custom {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
        }
        .btn-action {
            margin: 0 2px;
            border-radius: 20px;
        }
        .badge-custom {
            border-radius: 15px;
            padding: 0.5rem 1rem;
        }
        body {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark navbar-custom">
    <div class="container-fluid">
        <a class="navbar-brand" href="/turnos/dashboard">
            <i class="fas fa-hospital-alt me-2"></i>
            Centro Médico - Dashboard
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/turnos/dashboard">
                        <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/turnos">
                        <i class="fas fa-calendar-alt me-1"></i>Turnos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/turnos/esperando">
                        <i class="fas fa-clock me-1"></i>En Espera
                    </a>
                </li>
            </ul>
            <div class="navbar-nav">
                <span class="navbar-text text-white">
                    <i class="fas fa-calendar-day me-1"></i>
                    <span th:text="${#temporals.format(fecha, 'dd/MM/yyyy')}">07/09/2025</span>
                </span>
            </div>
        </div>
    </div>
</nav>

<div class="container-fluid mt-4">

    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="text-center text-dark">
                <i class="fas fa-tachometer-alt text-primary me-2"></i>
                Dashboard de Turnos
            </h1>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${success}">Operación exitosa</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-triangle me-2"></i>
        <span th:text="${error}">Error</span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6">
            <div class="stats-card">
                <i class="fas fa-calendar-check fa-2x mb-2"></i>
                <h3 th:text="${totalTurnos ?: 0}">0</h3>
                <p class="mb-0">Total Turnos Hoy</p>
                <small>
                    <a href="/turnos" class="text-white text-decoration-none">
                        Ver todos <i class="fas fa-arrow-right"></i>
                    </a>
                </small>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="stats-card warning">
                <i class="fas fa-clock fa-2x mb-2"></i>
                <h3 th:text="${turnosEnEspera ?: 0}">0</h3>
                <p class="mb-0">En Espera</p>
                <small>
                    <a href="/turnos/esperando" class="text-white text-decoration-none">
                        Ver espera <i class="fas fa-arrow-right"></i>
                    </a>
                </small>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="stats-card success">
                <i class="fas fa-user-md fa-2x mb-2"></i>
                <h3 th:text="${turnosAtendiendo ?: 0}">0</h3>
                <p class="mb-0">Atendiendo</p>
                <small>En consulta médica</small>
            </div>
        </div>

        <div class="col-lg-3 col-md-6">
            <div class="stats-card info">
                <i class="fas fa-check-circle fa-2x mb-2"></i>
                <h3 th:text="${turnosFinalizados ?: 0}">0</h3>
                <p class="mb-0">Finalizados</p>
                <small>
                    <a href="/turnos/estadisticas" class="text-white text-decoration-none">
                        Ver estadísticas <i class="fas fa-arrow-right"></i>
                    </a>
                </small>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row">
        <!-- Turnos en Espera -->
        <div class="col-lg-6 mb-4">
            <div class="table-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="text-warning">
                        <i class="fas fa-clock me-2"></i>
                        Turnos en Espera
                    </h4>
                    <span class="badge bg-warning badge-custom" th:text="${#lists.size(listaTurnosEspera) ?: 0}">0</span>
                </div>

                <div th:if="${#lists.isEmpty(listaTurnosEspera)}" class="text-center py-4">
                    <i class="fas fa-info-circle fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No hay turnos en espera</h5>
                    <p class="text-muted">Los próximos turnos aparecerán aquí</p>
                </div>

                <div th:unless="${#lists.isEmpty(listaTurnosEspera)}" class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                        <tr>
                            <th>Hora</th>
                            <th>Paciente</th>
                            <th>Médico</th>
                            <th>Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="turno : ${listaTurnosEspera}">
                            <td>
                                    <span class="badge bg-secondary"
                                          th:text="${turno.horaProgramada != null ? #temporals.format(turno.horaProgramada, 'HH:mm') : 'Sin hora'}">
                                        09:00
                                    </span>
                            </td>
                            <td>
                                <div th:if="${turno.paciente != null}">
                                    <strong th:text="${turno.paciente.nombre + ' ' + turno.paciente.apellido}">
                                        Juan Pérez
                                    </strong>
                                    <br>
                                    <small class="text-muted" th:text="'DNI: ' + ${turno.paciente.dni}">
                                        DNI: 12345678
                                    </small>
                                </div>
                                <span th:unless="${turno.paciente != null}" class="text-muted fst-italic">Sin paciente</span>
                            </td>
                            <td>
                                <div th:if="${turno.medico != null}">
                                        <span th:text="${turno.medico.nombre + ' ' + turno.medico.apellido}">
                                            Dr. García
                                        </span>
                                    <br>
                                    <small class="text-muted"
                                           th:text="${turno.medico.especialidad?.nombre ?: 'Sin especialidad'}">
                                        Medicina General
                                    </small>
                                </div>
                                <span th:unless="${turno.medico != null}" class="text-muted fst-italic">Sin médico</span>
                            </td>
                            <td>
                                <form th:action="@{/turnos/{id}/llamar(id=${turno.id})}"
                                      method="post"
                                      style="display: inline;">
                                    <button type="submit"
                                            class="btn btn-primary btn-sm btn-action"
                                            title="Llamar paciente">
                                        <i class="fas fa-volume-up"></i>
                                        Llamar
                                    </button>
                                </form>
                                <a th:href="@{/turnos/{id}(id=${turno.id})}"
                                   class="btn btn-info btn-sm btn-action"
                                   title="Ver detalles">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Turnos en Atención -->
        <div class="col-lg-6 mb-4">
            <div class="table-container">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h4 class="text-success">
                        <i class="fas fa-user-md me-2"></i>
                        Turnos en Atención
                    </h4>
                    <span class="badge bg-success badge-custom" th:text="${#lists.size(listaTurnosAtendiendo) ?: 0}">0</span>
                </div>

                <div th:if="${#lists.isEmpty(listaTurnosAtendiendo)}" class="text-center py-4">
                    <i class="fas fa-stethoscope fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No hay turnos en atención</h5>
                    <p class="text-muted">Las consultas activas aparecerán aquí</p>
                </div>

                <div th:unless="${#lists.isEmpty(listaTurnosAtendiendo)}" class="table-responsive">
                    <table class="table table-hover">
                        <thead class="table-light">
                        <tr>
                            <th>Hora</th>
                            <th>Paciente</th>
                            <th>Médico</th>
                            <th>Acciones</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="turno : ${listaTurnosAtendiendo}">
                            <td>
                                    <span class="badge bg-success"
                                          th:text="${turno.horaProgramada != null ? #temporals.format(turno.horaProgramada, 'HH:mm') : 'Sin hora'}">
                                        10:00
                                    </span>
                                <br>
                                <small class="text-success">
                                    <i class="fas fa-circle" style="animation: blink 1s infinite;"></i>
                                    En curso
                                </small>
                            </td>
                            <td>
                                <div th:if="${turno.paciente != null}">
                                    <strong th:text="${turno.paciente.nombre + ' ' + turno.paciente.apellido}">
                                        María González
                                    </strong>
                                    <br>
                                    <small class="text-muted" th:text="'DNI: ' + ${turno.paciente.dni}">
                                        DNI: 87654321
                                    </small>
                                </div>
                            </td>
                            <td>
                                <div th:if="${turno.medico != null}">
                                        <span th:text="${turno.medico.nombre + ' ' + turno.medico.apellido}">
                                            Dra. López
                                        </span>
                                    <br>
                                    <small class="text-muted"
                                           th:text="${turno.medico.consultorio?.numero != null ? 'Consultorio ' + turno.medico.consultorio.numero : 'Sin consultorio'}">
                                        Consultorio 101
                                    </small>
                                </div>
                            </td>
                            <td>
                                <form th:action="@{/turnos/{id}/finalizar(id=${turno.id})}"
                                      method="post"
                                      style="display: inline;">
                                    <button type="submit"
                                            class="btn btn-success btn-sm btn-action"
                                            title="Finalizar consulta">
                                        <i class="fas fa-check"></i>
                                        Finalizar
                                    </button>
                                </form>
                                <a th:href="@{/turnos/{id}(id=${turno.id})}"
                                   class="btn btn-info btn-sm btn-action"
                                   title="Ver detalles">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="table-container">
                <h4 class="mb-3">
                    <i class="fas fa-link me-2"></i>
                    Accesos Rápidos
                </h4>
                <div class="row g-3">
                    <div class="col-md-2 col-6">
                        <a href="/turnos" class="btn btn-primary w-100">
                            <i class="fas fa-list me-2"></i>
                            Todos los Turnos
                        </a>
                    </div>
                    <div class="col-md-2 col-6">
                        <a href="/turnos/esperando" class="btn btn-warning w-100">
                            <i class="fas fa-clock me-2"></i>
                            En Espera
                        </a>
                    </div>
                    <div class="col-md-2 col-6">
                        <a href="/turnos/estadisticas" class="btn btn-info w-100">
                            <i class="fas fa-chart-bar me-2"></i>
                            Estadísticas
                        </a>
                    </div>
                    <div class="col-md-2 col-6">
                        <button onclick="window.location.reload();" class="btn btn-secondary w-100">
                            <i class="fas fa-sync-alt me-2"></i>
                            Actualizar
                        </button>
                    </div>
                    <div class="col-md-2 col-6">
                        <button onclick="window.print();" class="btn btn-dark w-100">
                            <i class="fas fa-print me-2"></i>
                            Imprimir
                        </button>
                    </div>
                    <div class="col-md-2 col-6">
                        <a href="#" class="btn btn-outline-primary w-100">
                            <i class="fas fa-cog me-2"></i>
                            Configurar
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // Auto-refresh cada 30 segundos
    setTimeout(function() {
        window.location.reload();
    }, 30000);

    // Blinking animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }
    `;
    document.head.appendChild(style);

    // Auto-hide alerts
    setTimeout(function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(alert => {
            alert.style.opacity = '0';
            setTimeout(() => alert.remove(), 500);
        });
    }, 5000);
</script>

</body>
</html>