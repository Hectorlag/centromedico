<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Detalle Turno</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    .estado-badge {
        padding: 0.75rem 1.5rem;
        font-size: 1rem;
        font-weight: 600;
        border-radius: 8px;
    }

    .estado-esperando {
        background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
    }

    .estado-llamado {
        background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
    }

    .estado-atendiendo {
        background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
    }

    .estado-finalizado {
        background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
    }

    .estado-cancelado {
        background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);
    }
  </style>
</head>
<body>
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-md-10">
      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="mb-0">
          <i class="fas fa-calendar-check text-primary me-2"></i>
          Detalle del Turno
        </h2>
        <a th:href="@{/turnos/lista}" class="btn btn-outline-secondary">
          <i class="bi bi-arrow-left"></i> Volver
        </a>
      </div>

      <!-- Mensajes Flash -->
      <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <span th:text="${success}"></span>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>

      <!-- Estado del Turno -->
      <div class="card mb-4 text-center">
        <div class="card-body py-4">
          <h5 class="mb-3">Estado del Turno</h5>
          <span class="badge estado-badge text-white"
                th:classappend="${turno.estado == 'ESPERANDO' ? 'estado-esperando' :
                                               turno.estado == 'LLAMADO' ? 'estado-llamado' :
                                               turno.estado == 'ATENDIENDO' ? 'estado-atendiendo' :
                                               turno.estado == 'FINALIZADO' ? 'estado-finalizado' :
                                               'estado-cancelado'}"
                th:text="${turno.estado}">
                            ESPERANDO
                        </span>
        </div>
      </div>

      <!-- Información del Turno -->
      <div class="row">
        <!-- Datos del Paciente -->
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0">
                <i class="fas fa-user me-2"></i>
                Datos del Paciente
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <strong><i class="bi bi-person-fill text-info me-2"></i>Nombre Completo:</strong>
                <p class="mb-0 ms-4" th:text="${turno.pacienteNombreCompleto}">Juan Pérez</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Datos del Médico -->
        <div class="col-md-6 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0">
                <i class="fas fa-user-md me-2"></i>
                Datos del Médico
              </h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <strong><i class="bi bi-person-badge-fill text-success me-2"></i>Nombre Completo:</strong>
                <p class="mb-0 ms-4" th:text="${turno.medicoNombreCompleto}">Dr. García</p>
              </div>
              <div class="mb-3">
                <strong><i class="fas fa-stethoscope text-success me-2"></i>Especialidad:</strong>
                <p class="mb-0 ms-4">
                                        <span th:if="${turno.especialidadNombre != null}"
                                              th:text="${turno.especialidadNombre}">Cardiología</span>
                  <span th:if="${turno.especialidadNombre == null}"
                        class="text-muted fst-italic">No especificada</span>
                </p>
              </div>
              <div>
                <strong><i class="fas fa-door-open text-success me-2"></i>Consultorio:</strong>
                <p class="mb-0 ms-4">
                                        <span th:if="${turno.consultorioNumero != null}"
                                              th:text="${'N° ' + turno.consultorioNumero}">N° 101</span>
                  <span th:if="${turno.consultorioNumero == null}"
                        class="text-muted fst-italic">No asignado</span>
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Fecha y Hora -->
      <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">
            <i class="fas fa-calendar-alt me-2"></i>
            Fecha y Hora
          </h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">
              <strong><i class="bi bi-calendar-event text-primary me-2"></i>Fecha:</strong>
              <p class="mb-0 ms-4 fs-5" th:text="${#temporals.format(turno.fecha, 'dd/MM/yyyy')}">01/10/2025</p>
            </div>
            <div class="col-md-6">
              <strong><i class="bi bi-clock text-primary me-2"></i>Hora Programada:</strong>
              <p class="mb-0 ms-4 fs-5" th:text="${turno.horaInicio}">09:00</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Acciones -->
      <div class="card shadow-sm">
        <div class="card-footer bg-light">
          <div class="d-flex justify-content-between flex-wrap gap-2">
            <a th:href="@{/turnos/lista}" class="btn btn-secondary">
              <i class="bi bi-arrow-left"></i> Volver al Listado
            </a>
            <div class="d-flex gap-2">
              <a th:href="@{/turnos/{id}/editar(id=${turno.id})}"
                 class="btn btn-warning"
                 th:if="${turno.estado == 'ESPERANDO'}">
                <i class="bi bi-pencil-fill"></i> Editar
              </a>
              <button type="button"
                      class="btn btn-danger"
                      th:if="${turno.estado == 'ESPERANDO'}"
                      data-bs-toggle="modal"
                      data-bs-target="#eliminarModal">
                <i class="bi bi-trash-fill"></i> Cancelar Turno
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Modal de confirmación de eliminación -->
<div class="modal fade" id="eliminarModal" tabindex="-1" aria-labelledby="eliminarModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="eliminarModalLabel">
          <i class="bi bi-exclamation-triangle-fill me-2"></i>
          Confirmar Cancelación
        </h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>¿Está seguro que desea cancelar el turno de <strong th:text="${turno.pacienteNombreCompleto}"></strong>?</p>
        <p class="text-danger mb-0">
          <i class="bi bi-exclamation-circle me-1"></i>
          Esta acción no se puede deshacer.
        </p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="bi bi-x-circle"></i> Cancelar
        </button>
        <form th:action="@{/turnos/{id}/eliminar(id=${turno.id})}" method="post" class="d-inline">
          <button type="submit" class="btn btn-danger">
            <i class="bi bi-trash-fill"></i> Eliminar Turno
          </button>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Auto-cerrar alerts
  setTimeout(function() {
      var alerts = document.querySelectorAll('.alert');
      alerts.forEach(function(alert) {
          var bsAlert = new bootstrap.Alert(alert);
          bsAlert.close();
      });
  }, 5000);
</script>
</body>
</html>